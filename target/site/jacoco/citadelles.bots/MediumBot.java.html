<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>MediumBot.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">projet2-e</a> &gt; <a href="index.source.html" class="el_package">citadelles.bots</a> &gt; <span class="el_source">MediumBot.java</span></div><h1>MediumBot.java</h1><pre class="source lang-java linenums">package citadelles.bots;

import citadelles.BotView;
import citadelles.Hand;
import citadelles.characters.Character;
import citadelles.districts.District;

import java.util.ArrayList;
import java.util.concurrent.atomic.AtomicInteger;

import static citadelles.characters.CharacterEnum.*;

/**
 * Class that contain all the logic of the medium bot
 */
public class MediumBot extends Bot {

    /**
     * Adds the hand of the bot and a list of the placed quarters.
     * Initializes the number of golds to 2.
     */
    public MediumBot(int id, Hand hand) {
<span class="fc" id="L23">        super(id, hand);</span>
<span class="fc" id="L24">    }</span>


    /**
     * Logic to choose if the bot will draw card or get gold
     *
     * If he has a lot of gold (&gt;5) and less than 2 cards then he draws cards
     * If he has 0 cards, then he draws
     * Otherwise he takes gold
     */
    @Override
    public void chooseCardOrGold() {
<span class="pc bpc" id="L36" title="3 of 6 branches missed.">        if ((getGold() &gt; 5 &amp;&amp; getHandSize() &lt; 2) || getHandSize() == 0) {</span>
<span class="fc" id="L37">            chooseAddCard();</span>
        } else {
<span class="fc" id="L39">            chooseAddGold();</span>
        }
<span class="fc" id="L41">    }</span>

    /**
     * Method choosing if the bot will construct a district or not
     *
     *
     */
    @Override
    public void eventuallyPlaceADistrict() {
<span class="fc" id="L50">        District maxPlaceableDistrict = getMaxPlaceableDistrict();</span>
<span class="pc bpc" id="L51" title="1 of 4 branches missed.">        if (maxPlaceableDistrict != null &amp;&amp; getGold() &gt;= maxPlaceableDistrict.getValue()) {</span>
<span class="fc" id="L52">            placeCard(getHandList().indexOf(maxPlaceableDistrict));</span>
        }
<span class="fc" id="L54">    }</span>

    /**
     * get the highest placeable district of the hand and if they are multiple choose one of a color that is not already placed on the board.
     * @return the district to place
     */
    private District getMaxPlaceableDistrict() {
<span class="fc" id="L61">        District districtPlaceable = null;</span>
<span class="fc bfc" id="L62" title="All 2 branches covered.">        for(District card : getHand().getListCard())</span>
        {
<span class="pc bpc" id="L64" title="2 of 4 branches missed.">            if(card.getValue()&lt;=getGold() &amp;&amp; !isDistrictAlreadyPlaced(card.getName())){</span>
<span class="pc bpc" id="L65" title="1 of 2 branches missed.">                if(districtPlaceable==null){</span>
<span class="fc" id="L66">                    districtPlaceable = card;</span>
                }
<span class="nc bnc" id="L68" title="All 2 branches missed.">                else if(card.getValue()&gt;=districtPlaceable.getValue()){</span>
<span class="nc bnc" id="L69" title="All 4 branches missed.">                    if(!isCategoryPlaced(card.getCategory()) &amp;&amp; isCategoryPlaced(districtPlaceable.getCategory())){</span>
<span class="nc" id="L70">                        districtPlaceable = card;</span>
                    }
                }
            }
<span class="fc" id="L74">        }</span>
<span class="fc" id="L75">        return districtPlaceable;</span>
    }

    /**
     * Logic of the bot if he is the Architect
     *
     * He tries to place the first two card he can place
     * @return An arrayList of district to place
     */
    @Override
    public ArrayList&lt;District&gt; logicArchitect() {
<span class="fc" id="L86">        ArrayList&lt;District&gt; districtToPlace = new ArrayList&lt;&gt;();</span>

<span class="fc bfc" id="L88" title="All 2 branches covered.">        if (getHandSize() &gt;= 2) {</span>
<span class="fc" id="L89">            districtToPlace.add(getHandList().get(0));</span>
<span class="fc" id="L90">            districtToPlace.add(getHandList().get(1));</span>
        }
<span class="fc bfc" id="L92" title="All 2 branches covered.">        else if (getHandSize() == 1) districtToPlace.add(getHandList().get(0));</span>
<span class="fc" id="L93">        return districtToPlace;</span>
    }

    /**
     * Logic of the bot if he is the Assassin
     *
     * Murders a random character other than himself
     *
     * @return The id of the character to kill
     */
    @Override
    public int logicAssassin() {
        int idRoleKilled;
<span class="fc" id="L106">        int nbCharacters = getGameView().getListAllCharacters().size();</span>
        do {
<span class="fc" id="L108">            idRoleKilled = (int) (Math.random() * nbCharacters);</span>
<span class="pc bpc" id="L109" title="2 of 4 branches missed.">        } while (idRoleKilled == ASSASSIN.getId() || isDiscarded(idRoleKilled));</span>

<span class="fc" id="L111">        return idRoleKilled;</span>
    }

    /**
     * Logic of the bot if he is the Warlord
     *
     * Destroys a district of the player who has the most buildings placed
     *
     * @return A tab of int containing the player who will lose a district and the district to destroy
     */
    @Override
    public int[] logicWarlord() {
<span class="fc" id="L123">        BotView player = null;</span>
<span class="fc" id="L124">        District districtChosen = null;</span>
<span class="fc" id="L125">        int citySize = 0;</span>

<span class="fc bfc" id="L127" title="All 2 branches covered.">        for (BotView bot : getGameView().getListAllBots()) {</span>
<span class="fc bfc" id="L128" title="All 8 branches covered.">            if (bot.getID() != getID() &amp;&amp; bot.getDistrictsPlaced().size() != 7 &amp;&amp; bot.getDistrictsPlaced().size() &gt; citySize &amp;&amp; bot.getCharacter().getId() != BISHOP.getId()) {</span>
<span class="pc bpc" id="L129" title="1 of 2 branches missed.">                for (District district : bot.getDistrictsPlaced()) {</span>
<span class="pc bpc" id="L130" title="1 of 4 branches missed.">                    if (district.getValue() - 1 &lt;= getGold() &amp;&amp; district.isCanBeDestruct()) {</span>
<span class="fc" id="L131">                        districtChosen = district;</span>
<span class="fc" id="L132">                        player = bot;</span>
<span class="fc" id="L133">                        citySize = bot.getDistrictsPlaced().size();</span>
<span class="fc" id="L134">                        break;</span>
                    }
<span class="fc" id="L136">                }</span>
            }
<span class="fc" id="L138">        }</span>
<span class="fc" id="L139">        return buildDataWarlord(player, districtChosen);</span>
    }

    /**
     * Logic of the bot if he is the Thief
     *
     * Steals from a character other than himself and the Assassin
     *
     * @return The character id to steal
     */
    @Override
    public int logicThief() {

        //Get a bot that is not him
<span class="fc" id="L153">        AtomicInteger id = new AtomicInteger();</span>
<span class="fc" id="L154">        id.set(-1);</span>

        //if no one is revealed
<span class="pc bpc" id="L157" title="1 of 2 branches missed.">        if (id.get() == -1) {</span>
<span class="fc" id="L158">            getGameView().getListAllCharacters().forEach(c -&gt; {</span>
<span class="pc bpc" id="L159" title="1 of 6 branches missed.">                if (c.getId() != getCharacterId() &amp;&amp; c.getId() != ASSASSIN.getId() &amp;&amp; !isDiscarded(c.getId())) {</span>
<span class="fc" id="L160">                    id.set(c.getId());</span>
                }
<span class="fc" id="L162">            });</span>
        }

        //try to steal the bot
<span class="fc" id="L166">        return id.get();</span>
    }

    /**
     * Logic of the bot if he is the Magician
     *
     * Swap cards with the person who has the most cards.
     * If he's the player with the most cards, he exchanges with the deck all his cards
     *
     * Return an int == -1 to exchange all his cards with the deck
     * Return an 0 &lt;= int &lt; nbBot to exchange the hand with bot hand
     */
    @Override
    public int logicMagician() {
<span class="fc" id="L180">        AtomicInteger choice = new AtomicInteger(-2);</span>
<span class="fc" id="L181">        AtomicInteger maxNb = new AtomicInteger(getHandSize());</span>
<span class="fc" id="L182">        getGameView().getListAllBots().forEach(bot -&gt; {</span>
<span class="pc bpc" id="L183" title="1 of 2 branches missed.">            if (bot.getNbCardHand() &gt; maxNb.get()) {</span>
<span class="nc" id="L184">                choice.set(bot.getID());</span>
<span class="nc" id="L185">                maxNb.set(bot.getNbCardHand());</span>
            }
<span class="fc" id="L187">        });</span>

<span class="pc bpc" id="L189" title="1 of 2 branches missed.">        if (choice.get() == -2) choice.set(-1);</span>
<span class="fc" id="L190">        return choice.get();</span>
    }

    /**
     * Logic if the bot has the Laboratory district
     *
     * If he has more than one card, he chooses to exchange a card with a value lower
     * than 3 (if he has one) for a gold
     *
     * @return The index of a card in his hand. -1 if he can't
     */
    @Override
    public int logicLaboratory() {
<span class="fc bfc" id="L203" title="All 2 branches covered.">        if (getHandSize() &gt; 0) {</span>
<span class="fc" id="L204">            District minDistrict = getDistrictHandMinValue();</span>
<span class="pc bpc" id="L205" title="1 of 2 branches missed.">            if (minDistrict != null){</span>
<span class="fc bfc" id="L206" title="All 2 branches covered.">                if (minDistrict.getValue() &lt; 3){</span>
<span class="fc" id="L207">                    return getHandList().indexOf(minDistrict);</span>
                }
            }

        }
<span class="fc" id="L212">        return -1;</span>
    }

    /**
     * Logic if the bot has the Factory district
     *
     * If he has more than 7 gold, he decides to exchange 3 golds for 3 cards
     *
     * @return True if he wants to use the Factory power
     */
    @Override
    public boolean logicFactory() {
<span class="fc bfc" id="L224" title="All 2 branches covered.">        return getGold() &gt; 7;</span>
    }

    /**
     * Logic if the bot has the Graveyard district
     *
     * If the destroyed district has already been built by the bot, then he does not buy it. Otherwise he always buys it.
     *
     * @param destructedDistrict The district that has been destroyed
     * @return True if the bot want to re-buy it
     */
    @Override
    public boolean logicGraveyard(District destructedDistrict) {
<span class="fc bfc" id="L237" title="All 2 branches covered.">        return !isDistrictAlreadyPlaced(destructedDistrict.getName());</span>
    }

    @Override
    public ArrayList&lt;District&gt; discardList() {
<span class="fc" id="L242">        return getHandList();</span>
    }

    /**
     * Logic for choosing a character
     *
     * Choose a character who brings him money in order to be able to place buildings more easily.
     *
     * @param charactersPicked
     * @return
     */
    @Override
    public Character chooseOneCharacter(ArrayList&lt;Character&gt; charactersPicked) {
<span class="fc bfc" id="L255" title="All 2 branches covered.">        for (Character character : charactersPicked) {</span>
<span class="pc bpc" id="L256" title="2 of 8 branches missed.">            if (character.getId() == MERCHANT.getId() || character.getId() == BISHOP.getId() || character.getId() == KING.getId() || character.getId() == WARLORD.getId())</span>
<span class="fc" id="L257">                return character;</span>
<span class="fc" id="L258">        }</span>
<span class="fc" id="L259">        return charactersPicked.get(0);</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L264">        return &quot;(Medium) --&gt;&quot;;</span>
    }

}


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>