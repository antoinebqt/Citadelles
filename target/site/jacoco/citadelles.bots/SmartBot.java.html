<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>SmartBot.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">projet2-e</a> &gt; <a href="index.source.html" class="el_package">citadelles.bots</a> &gt; <span class="el_source">SmartBot.java</span></div><h1>SmartBot.java</h1><pre class="source lang-java linenums">package citadelles.bots;

import citadelles.BotView;
import citadelles.Hand;
import citadelles.characters.Character;
import citadelles.districts.CategoryEnum;
import citadelles.districts.District;

import java.util.ArrayList;
import java.util.concurrent.atomic.AtomicInteger;

import static citadelles.characters.CharacterEnum.*;

/**
 * Class that contain all the logic of the smart bot
 */
public class SmartBot extends Bot {
    /**
     * Adds the hand of the bot and a list of the placed quarters.
     * initializes the number of golds to 2.
     */
    public SmartBot(int id, Hand hand) {
<span class="fc" id="L23">        super(id, hand);</span>
<span class="fc" id="L24">    }</span>

    /**
     * Logic to choose if the bot will draw card or get gold
     *
     * If he has the architect then he takes gold
     * If he has a lot of gold (&gt;5) and less than 2 cards then he draws cards
     * If he has 0 cards, then he draws
     * Otherwise he takes gold
     */
    @Override
    public void chooseCardOrGold() {
<span class="fc bfc" id="L36" title="All 8 branches covered.">        if (getCharacterId() != ARCHITECT.getId() &amp;&amp; ((getGold() &gt; 5 &amp;&amp; getHandSize() &lt; 2) || getHandSize() == 0)) {</span>
<span class="fc" id="L37">            chooseAddCard();</span>
        } else {
<span class="fc" id="L39">            chooseAddGold();</span>
        }
<span class="fc" id="L41">    }</span>

    /**
     * Method choosing if the bot will construct a district or not
     *
     *
     */
    @Override
    public void eventuallyPlaceADistrict() {
<span class="fc" id="L50">        District maxPlaceableDistrict = getMaxPlaceableDistrict();</span>
<span class="pc bpc" id="L51" title="1 of 4 branches missed.">        if (maxPlaceableDistrict != null &amp;&amp; getGold() &gt;= maxPlaceableDistrict.getValue()) {</span>
<span class="fc" id="L52">            placeCard(getHandList().indexOf(maxPlaceableDistrict));</span>
        }
<span class="fc" id="L54">    }</span>

    /**
     * get the highest placeable district of the hand and if they are multiple choose one of a color that is not already placed on the board.
     * @return the district to place
     */
    private District getMaxPlaceableDistrict() {
<span class="fc" id="L61">        District districtPlaceable = null;</span>
<span class="fc bfc" id="L62" title="All 2 branches covered.">        for(District card : getHand().getListCard())</span>
        {
<span class="pc bpc" id="L64" title="2 of 4 branches missed.">            if(card.getValue()&lt;=getGold() &amp;&amp; !isDistrictAlreadyPlaced(card.getName())){</span>
<span class="pc bpc" id="L65" title="1 of 2 branches missed.">                if(districtPlaceable==null){</span>
<span class="fc" id="L66">                    districtPlaceable = card;</span>
                }
<span class="nc bnc" id="L68" title="All 2 branches missed.">                else if(card.getValue()&gt;=districtPlaceable.getValue()){</span>
<span class="nc bnc" id="L69" title="All 4 branches missed.">                    if(!isCategoryPlaced(card.getCategory()) &amp;&amp; isCategoryPlaced(districtPlaceable.getCategory())){</span>
<span class="nc" id="L70">                        districtPlaceable = card;</span>
                    }
                }
            }
<span class="fc" id="L74">        }</span>
<span class="fc" id="L75">        return districtPlaceable;</span>
    }

    /**
     * Logic of the bot if he is the Architect
     *
     * He tries to place a special district or his best card
     * but check before himself if he has enough golds
     * @return An arrayList of district to place
     */
    @Override
    public ArrayList&lt;District&gt; logicArchitect() {
<span class="fc" id="L87">        ArrayList&lt;District&gt; districtToPlace = new ArrayList&lt;&gt;();</span>
<span class="fc" id="L88">        int firstSpecialDistrictIndex = firstSpecialDistrict();</span>
<span class="fc bfc" id="L89" title="All 4 branches covered.">        if (firstSpecialDistrictIndex != -1 &amp;&amp; getGold() &gt;= getHandList().get(firstSpecialDistrictIndex).getValue()){</span>
<span class="fc" id="L90">            districtToPlace.add(getHandList().get(firstSpecialDistrictIndex));</span>
<span class="fc" id="L91">            int value = getHandList().get(firstSpecialDistrictIndex).getValue();</span>
<span class="fc" id="L92">            getHandList().remove(getHandList().get(firstSpecialDistrictIndex));</span>
<span class="fc" id="L93">            District maxDistrict = getDistrictHandMaxValue();</span>
<span class="pc bpc" id="L94" title="1 of 4 branches missed.">            if (maxDistrict != null &amp;&amp; getGold() &gt;= value + maxDistrict.getValue()){</span>
<span class="fc" id="L95">                districtToPlace.add(maxDistrict);</span>
<span class="fc" id="L96">                getHandList().remove(maxDistrict);</span>
            }
<span class="fc" id="L98">        } else {</span>
<span class="fc" id="L99">            District maxDistrict1 = getDistrictHandMaxValue();</span>
<span class="pc bpc" id="L100" title="1 of 4 branches missed.">            if (maxDistrict1 != null &amp;&amp; getGold() &gt;= maxDistrict1.getValue()){</span>
<span class="nc" id="L101">                districtToPlace.add(maxDistrict1);</span>
<span class="nc" id="L102">                getHandList().remove(maxDistrict1);</span>
<span class="nc" id="L103">                District maxDistrict2 = getDistrictHandMaxValue();</span>
<span class="nc bnc" id="L104" title="All 4 branches missed.">                if (maxDistrict2 != null &amp;&amp; getGold() &gt;= maxDistrict1.getValue() + maxDistrict2.getValue()){</span>
<span class="nc" id="L105">                    districtToPlace.add(maxDistrict2);</span>
<span class="nc" id="L106">                    getHandList().remove(maxDistrict2);</span>
                }
            }
        }

<span class="fc" id="L111">        districtToPlace.forEach(district -&gt; getHandList().add(district));</span>

<span class="fc" id="L113">        return districtToPlace;</span>
    }


    /**
     * Logic of the bot if he is the Assassin
     *
     * Murders a random character other than himself
     *
     * @return The id of the character to kill
     */
    @Override
    public int logicAssassin() {
        int idRoleKilled;
<span class="fc" id="L127">        int nbCharacters = getGameView().getListAllCharacters().size();</span>
        do {
<span class="fc" id="L129">            idRoleKilled = (int) (Math.random() * nbCharacters);</span>
<span class="pc bpc" id="L130" title="2 of 4 branches missed.">        } while (idRoleKilled == ASSASSIN.getId() || isDiscarded(idRoleKilled));</span>

<span class="fc" id="L132">        return idRoleKilled;</span>
    }

    /**
     * Logic of the bot if he is the Warlord
     *
     * Destruct the max value district in the city of the more advanced player
     *
     * @return A tab of int containing the player who will lose a district and the district to destroy
     */
    @Override
    public int[] logicWarlord() {
<span class="fc" id="L144">        BotView player = null;</span>
<span class="fc" id="L145">        District districtChosen = null;</span>
<span class="fc" id="L146">        int citySize = 0;</span>

<span class="fc bfc" id="L148" title="All 2 branches covered.">        for (BotView bot : getGameView().getListAllBots()) {</span>
<span class="fc bfc" id="L149" title="All 8 branches covered.">            if (bot.getID() != getID() &amp;&amp; bot.getDistrictsPlaced().size() != 7 &amp;&amp; bot.getDistrictsPlaced().size() &gt; citySize &amp;&amp; bot.getCharacter().getId() != BISHOP.getId()) {</span>
<span class="fc" id="L150">                int districtChosenValue = 100;</span>
<span class="fc bfc" id="L151" title="All 2 branches covered.">                for (District district : bot.getDistrictsPlaced()) {</span>
<span class="fc bfc" id="L152" title="All 6 branches covered.">                    if (district.getValue() - 1 &lt;= getGold() &amp;&amp; district.getValue() &lt; districtChosenValue &amp;&amp; district.isCanBeDestruct()) {</span>
<span class="fc" id="L153">                        districtChosen = district;</span>
<span class="fc" id="L154">                        player = bot;</span>
<span class="fc" id="L155">                        districtChosenValue = district.getValue();</span>
<span class="fc" id="L156">                        citySize = bot.getDistrictsPlaced().size();</span>
                    }
<span class="fc" id="L158">                }</span>
            }
<span class="fc" id="L160">        }</span>
<span class="fc" id="L161">        return buildDataWarlord(player, districtChosen);</span>
    }

    /**
     * Logic of the bot if he is the Thief
     *
     * Steals from a character other than himself and the Assassin
     *
     * @return The character id to steal
     */
    @Override
    public int logicThief() {

        //get a bot that is not him
<span class="fc" id="L175">        AtomicInteger id = new AtomicInteger();</span>
<span class="fc" id="L176">        id.set(-1);</span>

        //if no one is revealed
<span class="pc bpc" id="L179" title="1 of 2 branches missed.">        if (id.get() == -1) {</span>
<span class="fc" id="L180">            getGameView().getListAllCharacters().forEach(c -&gt; {</span>
<span class="pc bpc" id="L181" title="2 of 8 branches missed.">                if (c.getId() != getCharacterId() &amp;&amp; c.getId() != getGameView().getDeadBotCharacter() &amp;&amp; c.getId() != ASSASSIN.getId() &amp;&amp; !isDiscarded(c.getId())) {</span>
<span class="fc" id="L182">                    id.set(c.getId());</span>
                }
<span class="fc" id="L184">            });</span>
        }

        //try to steal the bot
<span class="fc" id="L188">        return id.get();</span>
    }

    /**
     * Logic of the bot if he is the Magician
     *
     * If he has less than 3 card in hand, Swap cards with the person who has the most cards.
     * If not, exchange with the deck the cards he already has.
     *
     * Return an int == -1 to exchange all his cards with the deck
     * Return an 0 &lt;= int &lt; nbBot to exchange the hand with bot hand
     */
    @Override
    public int logicMagician() {
<span class="fc" id="L202">        AtomicInteger choice = new AtomicInteger(-2);</span>
<span class="fc" id="L203">        AtomicInteger maxNb = new AtomicInteger(getHandSize());</span>
<span class="pc bpc" id="L204" title="1 of 2 branches missed.">        if (getHandSize() &lt; 3){</span>
<span class="nc" id="L205">            getGameView().getListAllBots().forEach(bot -&gt; {</span>
<span class="nc bnc" id="L206" title="All 2 branches missed.">                if (bot.getNbCardHand() &gt; maxNb.get()) {</span>
<span class="nc" id="L207">                    choice.set(bot.getID());</span>
<span class="nc" id="L208">                    maxNb.set(bot.getNbCardHand());</span>
                }
<span class="nc" id="L210">            });</span>
        }

<span class="pc bpc" id="L213" title="1 of 2 branches missed.">        if (choice.get() == -2) choice.set(-1);</span>
<span class="fc" id="L214">        return choice.get();</span>
    }

    /**
     * Logic if the bot has the Laboratory district
     *
     * If he has more than one card and less than 3 gold, he chooses to exchange
     * a card with a value lower than 3 (if he has one) for a gold
     *
     * @return The index of a card in his hand. -1 if he can't
     */
    @Override
    public int logicLaboratory() {
<span class="fc bfc" id="L227" title="All 4 branches covered.">        if (getHandSize() &gt; 0 &amp;&amp; getGold() &lt; 3) {</span>
<span class="fc" id="L228">            District minDistrict = getDistrictHandMinValue();</span>
<span class="pc bpc" id="L229" title="1 of 2 branches missed.">            if (minDistrict != null){</span>
<span class="fc bfc" id="L230" title="All 2 branches covered.">                if (minDistrict.getValue() &lt; 3){</span>
<span class="fc" id="L231">                    return getHandList().indexOf(minDistrict);</span>
                }
            }
        }
<span class="fc" id="L235">        return -1;</span>
    }

    /**
     * Logic if the bot has the Factory district
     *
     * If he has more than 7 gold and less than 3 cards
     * in his hand, then he decides to exchange 3 golds for 3 cards
     *
     * @return True if he wants to use the Factory power
     */
    @Override
    public boolean logicFactory() {
<span class="fc bfc" id="L248" title="All 4 branches covered.">        return (getGold() &gt; 7 &amp;&amp; getHandSize() &lt; 3);</span>
    }

    /**
     * Logic if the bot has the Graveyard district
     *
     * If the destroyed district has already been placed by the player then he does not buy it.
     * Otherwise, if it is a special district, he buys it.
     * If not, he buys it only if the value of the district is higher than 2
     * and the bot has more than 5 golds.
     *
     * @param destructedDistrict The district that has been destroyed
     * @return True if the bot want to re-buy it
     */
    @Override
    public boolean logicGraveyard(District destructedDistrict) {
<span class="fc bfc" id="L264" title="All 2 branches covered.">        if (isDistrictAlreadyPlaced(destructedDistrict.getName())) {</span>
<span class="fc" id="L265">            return false;</span>
        }
<span class="fc bfc" id="L267" title="All 2 branches covered.">        if (destructedDistrict.getCategory() == CategoryEnum.UNIQUE.getValue()){</span>
<span class="fc" id="L268">            return true;</span>
        }
<span class="pc bpc" id="L270" title="1 of 4 branches missed.">        return destructedDistrict.getValue() &gt; 2 &amp;&amp; getGold() &gt; 5;</span>
    }

    @Override
    public ArrayList&lt;District&gt; discardList() {
<span class="fc" id="L275">        ArrayList&lt;District&gt; discards = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L276" title="All 2 branches covered.">        for (District district : getHandList()) {</span>
<span class="fc bfc" id="L277" title="All 2 branches covered.">            if (isDistrictAlreadyPlaced(district.getName())) discards.add(district);</span>
<span class="fc" id="L278">        }</span>
<span class="fc" id="L279">        return discards;</span>
    }

    @Override
    public String toString() {
<span class="fc" id="L284">        return &quot;(Smart) ---&gt;&quot;;</span>
    }

    @Override
    public District chooseOneCard(ArrayList&lt;District&gt; districtsPicked) {
<span class="pc bpc" id="L289" title="1 of 2 branches missed.">        for (District district : districtsPicked) {</span>
<span class="fc bfc" id="L290" title="All 2 branches covered.">            if (!isPlayerHaveDistrict(district)) return district;</span>
<span class="fc" id="L291">        }</span>
<span class="nc" id="L292">        return super.chooseOneCard(districtsPicked);</span>
    }

    /**
     * Return in first the architect if hand size == 0
     * Or try to pick the character with an earning gold action which gain the most of gold possible
     * Otherwise do the default action
     *
     * @param charactersPicked character arraylist
     * @return a character
     */
    @Override
    public Character chooseOneCharacter(ArrayList&lt;Character&gt; charactersPicked) {
<span class="fc" id="L305">        int[] dataDistrictsPlaced = numberOfEachCategoriesPlaced();</span>
<span class="fc" id="L306">        Character choice = null;</span>
<span class="fc" id="L307">        int choiceValue = 0;</span>
<span class="fc" id="L308">        int maxGolds = 3;</span>
<span class="fc" id="L309">        boolean canPlace = canPlace();</span>

<span class="fc bfc" id="L311" title="All 2 branches covered.">        for (Character character : charactersPicked) {</span>
<span class="pc bpc" id="L312" title="4 of 8 branches missed.">            if (character.getId() == ASSASSIN.getId() &amp;&amp; canPlace &amp;&amp; getDistrictPlaced().size() == 6 &amp;&amp; choiceValue &lt; 10) {</span>
<span class="nc" id="L313">                choice = character;</span>
<span class="nc" id="L314">                choiceValue = 10;</span>
            }

            // if no card and char is architect, take it
<span class="pc bpc" id="L318" title="2 of 8 branches missed.">            if ((getHandSize() == 0 || !canPlace) &amp;&amp; character.getId() == ARCHITECT.getId() &amp;&amp; choiceValue &lt; 9) {</span>
<span class="fc" id="L319">                choice = character;</span>
<span class="fc" id="L320">                choiceValue = 9;</span>
            }

            //if the bot has more than 3 districts of the type of the character he takes it
<span class="fc" id="L324">            int goldGains = maxGold(character.getId(), dataDistrictsPlaced);</span>
<span class="pc bpc" id="L325" title="1 of 6 branches missed.">            if (goldGains &gt;= maxGolds &amp;&amp; getGold() &lt;= 10 &amp;&amp; choiceValue &lt; 8) {</span>
<span class="fc" id="L326">                choice = character;</span>
<span class="fc" id="L327">                choiceValue = 8;</span>
            }

<span class="pc bpc" id="L330" title="1 of 6 branches missed.">            if (hasTheLessGolds() &amp;&amp; character.getId() == THIEF.getId() &amp;&amp; choiceValue &lt; 7) {</span>
<span class="fc" id="L331">                choice = character;</span>
<span class="fc" id="L332">                choiceValue = 7;</span>
            }

<span class="pc bpc" id="L335" title="1 of 6 branches missed.">            if (hasLessCardsThanSomeone() &amp;&amp; character.getId() == MAGICIAN.getId() &amp;&amp; choiceValue &lt; 6) {</span>
<span class="fc" id="L336">                choice = character;</span>
<span class="fc" id="L337">                choiceValue = 6;</span>
            }
<span class="fc" id="L339">        }</span>

        //if no choice done then choose the first one
<span class="pc bpc" id="L342" title="1 of 2 branches missed.">        if (choice == null) {</span>
<span class="nc" id="L343">            choice = charactersPicked.get(0);</span>
        }
<span class="fc" id="L345">        return choice;</span>
    }
}


</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>